<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>for my wifey mira ğŸ¤</title>
  <style>
    :root {
      --bg: #1b140f;          /* deep espresso */
      --card: #2a2018;        /* cocoa */
      --accent: #c19a6b;      /* warm brown */
      --accent-2: #8b6b4f;    /* latte */
      --text: #f5efe8;        /* cream */
      --muted: #d9cfc3;
      --petal: rgba(255,182,193,0.95); /* pink */
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Cairo', 'Amiri', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, #3a2a1e 0%, transparent 60%),
        radial-gradient(1200px 600px at 90% 10%, #5a3f2c 0%, transparent 60%),
        var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
    }

    .container { max-width: 980px; padding: 24px; width: 100%; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 28px;
      box-shadow: 0 25px 70px rgba(0,0,0,0.45);
      padding: 28px;
      overflow: hidden;
    }

    header { text-align: center; margin-bottom: 18px; }
    header h1 { font-size: clamp(30px, 4.5vw, 48px); margin: 0 0 8px; }
    header p { color: var(--muted); margin: 0; }

    .grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 20px; }
    @media (max-width: 760px) { .grid { grid-template-columns: 1fr; } }

    .panel {
      background: var(--card);
      border-radius: 22px;
      padding: 22px;
      position: relative;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* visible pink petal/flower border */
    .panel::before {
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: 28px;
      pointer-events: none;
      background:
        repeating-radial-gradient(circle at 8px 8px,
          rgba(255,182,193,0.95) 0 3px,
          rgba(255,182,193,0.55) 3px 6px,
          transparent 6px 16px);
      mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      mask-composite: exclude;
      -webkit-mask-composite: xor;
      padding: 3px;
      opacity: 1;
      filter: drop-shadow(0 0 9px rgba(255,182,193,0.65));
    }

    .panel h2 { margin-top: 0; color: var(--accent); }
    .panel p { line-height: 1.9; }

    .timeline { display: grid; gap: 14px; }
    .moment {
      position: relative;
      box-shadow: 0 0 0 2px rgba(193,154,107,0.18);
      display: grid;
      grid-template-columns: 60px 1fr;
      gap: 12px;
      align-items: center;
      border-radius: 18px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      background-size: cover;
      background-position: center;
      overflow: hidden;
      animation: slowZoom 18s ease-in-out infinite alternate;
    }

    @keyframes slowZoom {
      from { background-size: 100%; }
      to { background-size: 112%; }
    }

    .moment::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(120% 120% at 50% 30%, rgba(27,20,15,0.55), rgba(27,20,15,0.9));
      backdrop-filter: blur(2px);
      z-index: 0;
    }

    .moment::after {
      content: attr(data-caption);
      position: absolute;
      bottom: 10px;
      right: 14px;
      font-size: 13px;
      color: var(--accent);
      opacity: 0;
      transition: opacity 0.6s ease;
      font-style: italic;
      z-index: 1;
    }

    .moment:hover::after { opacity: 1; }
    .moment > * { position: relative; z-index: 1; }

    .badge {
      display: grid;
      place-items: center;
      height: 60px;
      border-radius: 14px;
      background: rgba(20,15,11,0.9);
      color: var(--accent);
      font-weight: 800;
      font-size: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(2px);
    }

    .moment small { color: var(--muted); }

    .cta {
      margin-top: 18px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      appearance: none;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #2b1d12;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 800;
      box-shadow: 0 12px 35px rgba(193,154,107,0.35);
    }

    .ghost {
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: none;
    }

    .hidden { display: none; }

    /* gallery */
    .gallery {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    @media (max-width: 760px) { .gallery { grid-template-columns: repeat(2, 1fr); } }

    .photo {
      position: relative;
      box-shadow: 0 0 0 2px rgba(193,154,107,0.22);
      background: #120d09;
      border: 1px dashed rgba(255,255,255,0.25);
      border-radius: 16px;
      aspect-ratio: 1 / 1;
      display: grid;
      place-items: center;
      color: var(--muted);
      font-size: 14px;
      overflow: hidden;
    }

    /* soft heart pulse (enabled when in view) */
    .photo.pulse {
      animation: softPulse 2.8s ease-in-out infinite;
    }

    @keyframes softPulse {
      0%, 100% {
        box-shadow: 0 0 0 2px rgba(193,154,107,0.22), 0 0 0 rgba(193,154,107,0);
      }
      50% {
        box-shadow: 0 0 0 2px rgba(193,154,107,0.30), 0 0 35px rgba(193,154,107,0.22);
      }
    }

    /* hover captions */
    .photo .cap {
      position: absolute;
      left: 10px;
      right: 10px;
      bottom: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(18,13,9,0.12), rgba(18,13,9,0.82));
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--text);
      font-size: 13px;
      line-height: 1.35;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 280ms ease, transform 280ms ease;
      pointer-events: none;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      text-shadow: 0 2px 10px rgba(0,0,0,0.45);
    }

    .photo:hover .cap {
      opacity: 1;
      transform: translateY(0);
    }

    .photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 16px;
      transform: scale(1.02);
      animation: photoZoom 18s ease-in-out infinite alternate;
      filter: saturate(1.02) contrast(1.02);
    }

    @keyframes photoZoom {
      from { transform: scale(1.02); }
      to { transform: scale(1.12); }
    }

    .photo:hover img { transform: scale(1.14); }

    .footer {
      text-align: center;
      margin-top: 18px;
      color: var(--muted);
      font-size: 14px;
    }

    /* distance counter */
    .distance {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    .distance .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    @media (max-width: 760px) { .distance .row { grid-template-columns: 1fr; } }

    input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(18,13,9,0.8);
      color: var(--text);
      outline: none;
    }

    input::placeholder { color: rgba(217,207,195,0.7); }

    .result {
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      color: var(--muted);
    }

    /* proposal modal (extra special) */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(0,0,0,0.62);
      padding: 18px;
      z-index: 999;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      animation: modalFade 220ms ease-out;
    }

    @keyframes modalFade { from { opacity: 0; } to { opacity: 1; } }

    .modal.open { display: grid; }

    body.modal-open { overflow: hidden; }

    .modal-card {
      max-width: 680px;
      width: 100%;
      border-radius: 28px;
      padding: 28px;
      background:
        radial-gradient(120% 120% at 50% 20%, rgba(193,154,107,0.25), rgba(42,32,24,0.95)),
        linear-gradient(180deg, rgba(42,32,24,0.95), rgba(27,20,15,0.92));
      border: 1px solid rgba(193,154,107,0.55);
      box-shadow:
        0 0 0 1px rgba(193,154,107,0.25),
        0 0 40px rgba(193,154,107,0.35),
        0 0 120px rgba(193,154,107,0.15);
      text-align: center;
      position: relative;
      overflow: hidden;
      animation: proposalGlow 4s ease-in-out infinite alternate;
    }

    @keyframes proposalGlow {
      from {
        box-shadow:
          0 0 0 1px rgba(193,154,107,0.25),
          0 0 30px rgba(193,154,107,0.25),
          0 0 80px rgba(193,154,107,0.12);
      }
      to {
        box-shadow:
          0 0 0 1px rgba(193,154,107,0.55),
          0 0 55px rgba(193,154,107,0.45),
          0 0 140px rgba(193,154,107,0.22);
      }
    }

    .modal-card h2 { margin: 0 0 10px; color: var(--accent); font-size: 32px; }
    .modal-card p { margin: 0 0 14px; color: var(--muted); line-height: 1.85; }

    .arabicline {
      font-family: 'Amiri','Cairo',serif;
      color: var(--accent);
      opacity: 0.95;
      font-size: 18px;
      margin-top: -4px;
    }

    .proposal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    /* sparkles */
    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(193,154,107,0.95);
      box-shadow: 0 0 18px rgba(193,154,107,0.9);
      animation: sparklePop 900ms ease-out forwards;
      pointer-events: none;
    }

    @keyframes sparklePop {
      0% { transform: translate(0,0) scale(0.2); opacity: 0; }
      15% { opacity: 1; }
      100% { transform: translate(var(--dx), var(--dy)) scale(1.1); opacity: 0; }
    }

    /* floating hearts */
    .heart {
      position: fixed;
      bottom: -20px;
      font-size: 18px;
      animation: floatUp linear forwards;
      pointer-events: none;
      opacity: 0.9;
    }

    @keyframes floatUp { to { transform: translateY(-110vh); opacity: 0; } }

    /* drifting petals */
    .petal {
      position: fixed;
      top: -20px;
      font-size: 18px;
      opacity: 0.85;
      pointer-events: none;
      animation: petalFall linear forwards;
      filter: drop-shadow(0 2px 6px rgba(255,182,193,0.65));
    }

    @keyframes petalFall {
      0% { transform: translateX(0) rotate(0deg); opacity: 0; }
      10% { opacity: 0.9; }
      100% { transform: translateX(var(--drift)) translateY(110vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>to <span style="color:var(--accent)">Ù…ÙŠØ±Ø§</span> ğŸ¤</h1>
        <p>from the heart of <strong>Ø¬Ø§Ù‡ÙØ¯</strong> because distance could never change the love we have</p>
      </header>

      <section class="grid" style="margin-top:14px">
        <div class="panel">
          <h2>A Love Note</h2>
          <p class="poem" style="white-space:pre-line; line-height:2">
            to my hayyati, my qalbi
            the woman of my dreams, the noor of my eyes

            every day with you,
            is love's wonderful surprise

            i won't ever let you forget
            just how much to me you mean

            because you've made a lover out of me
            and together we'll live beautiful dreams

            i'm not picky like you,
            but how wonderful it feels

            chosen and honoured to love you
            for the rest of my earthly years

            to feel you in my arms, your skin against mine
            to heat up your hands when they're cold all the time

            to make you coffee in the mornings
            to brush your hair from your face

            to hold you until you're squished
            in my arm's tightest of embraces

            to read you to sleep for the rest of our lives
            as the man chosen to be by your side

            to be the best husbo i can be
            and the 'super baba' to our leah

            i promise all of these forever and ever
            and to love you, fi dunya wa akhira
          </p>
          <p style="font-style:italic; color:var(--accent)">Ø£Ù†ØªÙ Ø³ÙƒÙ†ÙŠ ÙˆØ·Ù…Ø£Ù†ÙŠÙ†ØªÙŠ</p>

          <div class="cta">
            <button onclick="reveal()">Ù…ÙØ§Ø¬Ø£Ø© Ù„ÙƒÙ âœ¨</button>
            <button class="ghost" onclick="spawnHearts()">Ù‚Ù„Ø¨ÙŠ Ù„ÙƒÙ ğŸ’•</button>
            <button class="ghost" onclick="openProposal()">press here for a surprise ğŸ¤</button>
          </div>
        </div>

        <div class="timeline">
          <div class="moment" style="background-image:url('moment1.jpg')" data-caption="Ù‚ÙØ¯ÙØ±ÙŒ Ø¬Ù…ÙŠÙ„">
            <div class="badge">ğŸ’¬</div>
            <div>
              <strong>when we first started talking</strong><br />
              <small>i had no idea that you would become my world</small>
            </div>
          </div>

          <div class="moment" style="background-image:url('moment2.jpg')" data-caption="Ø£Ø­Ø¨Ø¨ØªÙƒ Ø¯ÙˆÙ† ØªØ®Ø·ÙŠØ·">
            <div class="badge">ğŸ¤</div>
            <div>
              <strong>when i fell in love with you</strong><br />
              <small>distance never changed how i felt</small>
            </div>
          </div>

          <div class="moment" style="background-image:url('moment3.jpg')" data-caption="Ù‚Ø±ÙŠØ¨Ù‹Ø§ ÙŠØ§ Ø­Ø¨ÙŠØ¨ØªÙŠ">
            <div class="badge">âœˆï¸</div>
            <div>
              <strong>im counting down the days</strong><br />
              <small>until i hold you in my arms</small>
            </div>
          </div>
        </div>
      </section>

      <div class="panel" style="margin-top:20px">
        <h2>our memories so far...</h2>

        <div class="distance">
          <div class="row">
            <input id="cityA" placeholder="Your city (e.g., London)" value="Northampton, United Kingdom" />
            <input id="cityB" placeholder="Miraâ€™s city (e.g., Dubai)" value="Madinah, Saudi Arabia" />
          </div>
          <div class="cta" style="margin-top:0; justify-content:flex-start">
            <button onclick="calcDistance()">calculate our distance ğŸ¤</button>
            <button class="ghost" onclick="setManualDistance()">Enter it manually</button>
          </div>
          <div id="distanceResult" class="result">Distance counter: waitingâ€¦</div>
          <div style="color:var(--muted); font-size:13px">Tip: if a city lookup ever fails, use â€œEnter it manuallyâ€.</div>
        </div>

        <hr style="border:0; border-top:1px solid rgba(255,255,255,0.08); margin:16px 0" />
        <p style="color:var(--muted)">i'm gonna put photos of us here ğŸ¤</p>

        <div class="gallery" id="mainGallery">
          <div class="photo" title="us ğŸ¤">
            <img src="moment1.jpg" alt="Jahid and Mira kissing selfie" onerror="this.closest('.photo').textContent='Missing image: moment1.jpg';" />
            <div class="cap">our first kind of forever ğŸ¤</div>
          </div>
          <div class="photo" title="family ğŸ¤">
            <img src="moment2.jpg" alt="Jahid, Mira and Leah family photo" onerror="this.closest('.photo').textContent='Missing image: moment2.jpg';" />
            <div class="cap">our little family, my biggest blessing ğŸŒ¸</div>
          </div>
          <div class="photo" title="us ğŸ¤">
            <img src="moment3.jpg" alt="Jahid and Mira with heart" onerror="this.closest('.photo').textContent='Missing image: moment3.jpg';" />
            <div class="cap">your laugh, your glow, my favourite view ğŸ’–</div>
          </div>
        </div>
      </div>
      </div>

      <div class="panel" style="margin-top:20px">
        <h2>little things i love about us</h2>
        <p style="color:var(--muted)">screenshots, drawings, and moments that make me smile ğŸ¤</p>
        <div class="gallery" style="grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));">
          <div class="photo"><img src="IMG_3047.png" alt="Roblox Christmas" /></div>
          <div class="photo"><img src="B6AC75F5-47CC-41B4-A22F-A716909FAEC0.jpg" alt="Leah's Cafe drawing" /></div>
          <div class="photo"><img src="IMG_2587.jpeg" alt="I love my girlfriend shirt" /></div>
          <div class="photo"><img src="IMG_2462.jpeg" alt="Drawing" /></div>
          <div class="photo"><img src="A88A1C41-6FC4-4AC4-B8DA-FFCEE46C3E90.jpeg" alt="My favourite human" /></div>
          <div class="photo"><img src="7914C439-4A80-485E-991C-D2E3CD14286C.jpeg" alt="Wedding cartoon" /></div>
          <div class="photo"><img src="IMG_1006.jpeg" alt="Chocolate cake" /></div>
          <div class="photo"><img src="C7CB5BCE-B6FD-42E3-9AF2-2E133932C78C.jpg" alt="Family drawing strip" /></div>
          <div class="photo"><img src="IMG_0100.jpeg" alt="Laughing together photo" /></div>
          <div class="photo"><img src="IMG_0098.PNG" alt="Couple hugging with Arabic text" /></div>
          <div class="photo"><img src="IMG_3004.jpeg" alt="Lovelee drawing pregnancy" /></div>
          <div class="photo"><img src="IMG_2996.jpeg" alt="Lovelee family drawing" /></div>
        </div>
      </div>

      <div id="surprise" class="panel hidden" style="margin-top:20px">
        <h2>just for you my mira, my home, my princess ğŸŒ¹</h2>
        <p>you are my choice, my comfort, and the most beautiful thing in my life, iâ€™m so so so lucky to be yours</p>
        <p style="font-style:italic; color:var(--accent)">
          Ø£Ø­Ø¨Ùƒ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„ÙŠÙ†
          <br />
          i love you more than you can imagine, wallah
        </p>
      </div>

      <div class="panel" style="margin-top:20px">
        <h2>reasons i love you ğŸ¤</h2>
        <p style="color:var(--muted)">tap gentlyâ€¦ these are from my heart</p>

        <div id="reasonsBox" class="result" style="min-height:80px; display:flex; align-items:center; justify-content:center; text-align:center; font-style:italic;">
          click the button below, my love ğŸŒ¸
        </div>

        <div class="cta">
          <button onclick="nextReason()">another reason ğŸ¤</button>
        </div>
      </div>

      <div class="footer">made with love by your Ø¬Ø§Ù‡ÙØ¯, your jojo, and only for my Ù…ÙŠØ±Ø§ ğŸ¤</div>
    </div>
  </div>

  <!-- Proposal Modal -->
  <div id="proposalModal" class="modal" onclick="if(event.target.id==='proposalModal') closeProposal()">
    <div class="modal-card" id="proposalCard">
      <h2 id="proposalTitle">mira uwayyad al-mutairi, the love of my life, will you marry me?</h2>
      <div class="arabicline">Ù‡Ù„ ØªÙ‚Ø¨Ù„ÙŠÙ† Ø£Ù† ØªÙƒÙˆÙ†ÙŠ Ø²ÙˆØ¬ØªÙŠØŸ ğŸ’</div>
      <p id="proposalText">i donâ€™t want a future that doesnâ€™t include you. i canâ€™t live without you babyğŸ’˜ Ø£Ø­Ø¨Ùƒ</p>
      <div class="proposal-actions">
        <button onclick="yes()" style="font-size:18px; padding:14px 22px; box-shadow:0 0 25px rgba(193,154,107,0.6)">yes ğŸ¤</button>
        <button class="ghost" onmouseover="dodgeNo(this)" onclick="dodgeNo(this)">no</button>
        <button class="ghost" onclick="closeProposal()">close</button>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // ---------- Core UI ----------
    function reveal(){
      const el = document.getElementById('surprise');
      if(el) el.classList.remove('hidden');
      spawnHearts();
    }

    function spawnHearts(){
      const count = 28;
      for(let i=0;i<count;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        h.textContent = Math.random() > 0.5 ? 'ğŸ¤' : 'ğŸ’–';
        h.style.left = Math.random() * 100 + 'vw';
        h.style.animationDuration = (3 + Math.random() * 3) + 's';
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 6000);
      }
    }

    // gentle drifting petals
    function spawnPetal(){
      const p = document.createElement('div');
      p.className = 'petal';
      p.textContent = 'ğŸŒ¸';
      p.style.left = Math.random() * 100 + 'vw';
      p.style.setProperty('--drift', (Math.random()*120 - 60) + 'px');
      p.style.animationDuration = (10 + Math.random() * 10) + 's';
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 22000);
    }

    // ---------- Distance counter ----------
    async function geocodeCity(city){
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`;
      const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
      const data = await res.json();
      if(!data || !data.length) throw new Error('City not found');
      return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
    }

    function haversineKm(a, b){
      const R = 6371;
      const toRad = (d)=> d * Math.PI / 180;
      const dLat = toRad(b.lat - a.lat);
      const dLon = toRad(b.lon - a.lon);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);
      const s = Math.sin(dLat/2) ** 2 + Math.cos(lat1) * Math.cos(lat2) * (Math.sin(dLon/2) ** 2);
      const c = 2 * Math.asin(Math.min(1, Math.sqrt(s)));
      return R * c;
    }

    async function calcDistance(){
      const aRaw = document.getElementById('cityA')?.value?.trim() || '';
      const bRaw = document.getElementById('cityB')?.value?.trim() || '';
      const out = document.getElementById('distanceResult');
      if(!out) return;
      if(!aRaw || !bRaw){ out.textContent = 'Please enter both places.'; return; }

      // Reliable defaults (no external API required)
      const northamptonUK = { lat: 52.2405, lon: -0.9027 };
      const madinahSA = { lat: 24.5247, lon: 39.5692 };

      const kmDefault = haversineKm(northamptonUK, madinahSA);
      const milesDefault = kmDefault * 0.621371;

      const a = aRaw.toLowerCase();
      const b = bRaw.toLowerCase();
      const looksLikeNorthampton = a.includes('northampton');
      const looksLikeMadinah = b.includes('madin') || b.includes('medin');

      if(looksLikeNorthampton && looksLikeMadinah){
        out.innerHTML = `Distance between Northampton ğŸ‡¬ğŸ‡§ and Madinah ğŸ‡¸ğŸ‡¦: <strong>${kmDefault.toFixed(0)} km</strong> (${milesDefault.toFixed(0)} miles) â€” and I still choose you ğŸ¤`;
        spawnHearts();
        return;
      }

      // Optional: live lookup if the user changes the cities
      out.textContent = 'calculatingâ€¦';
      try {
        const [ga, gb] = await Promise.all([geocodeCity(aRaw), geocodeCity(bRaw)]);
        const km = haversineKm(ga, gb);
        const miles = km * 0.621371;
        out.innerHTML = `distance between you: <strong>${km.toFixed(0)} km</strong> (${miles.toFixed(0)} miles) and i'll always choose you ğŸ¤`;
      } catch (e) {
        out.innerHTML = `distance (fallback): <strong>${kmDefault.toFixed(0)} km</strong> (${milesDefault.toFixed(0)} miles) and i'll still always belong to you ğŸ¤`;
      }
      spawnHearts();
    }

    function setManualDistance(){
      const out = document.getElementById('distanceResult');
      if(!out) return;
      const val = prompt('Enter the distance (e.g., 5230 km):');
      if(!val) return;
      out.innerHTML = `Distance counter: <strong>${val}</strong> â€” <span style="color:var(--accent)">ÙˆØ¥Ù† Ø·Ø§Ù„ Ø§Ù„Ø¨Ø¹Ø¯â€¦ Ù‚Ù„Ø¨ÙŠ Ù…Ø¹ÙƒÙ</span>`;
      spawnHearts();
    }

    // ---------- Proposal surprise ----------
    function openProposal(){
      const m = document.getElementById('proposalModal');
      if(!m) return;
      m.classList.add('open');
      document.body.classList.add('modal-open');
      spawnHearts();
    }

    function closeProposal(){
      const m = document.getElementById('proposalModal');
      if(!m) return;
      m.classList.remove('open');
      document.body.classList.remove('modal-open');
    }

    function yes(){
      const title = document.getElementById('proposalTitle');
      const text = document.getElementById('proposalText');
      if(title) title.textContent = 'She said YES ğŸ¤';
      if(text) {
        text.innerHTML = "my forever starts with you, mira. youâ€™re my home, my heart. <span style='color:var(--accent)'>Ø£Ù†ØªÙ Ù†ØµÙŠØ¨ÙŠ</span> â€” you are my destiny.";
      }
      spawnHearts();
      sparkleBurst();
    }

    function dodgeNo(btn){
      const x = (Math.random() * 70) - 35;
      const y = (Math.random() * 70) - 35;
      btn.style.transform = `translate(${x}px, ${y}px)`;
    }

    function sparkleBurst(){
      const card = document.getElementById('proposalCard');
      if(!card) return;
      const n = 26;
      for(let i=0;i<n;i++){
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.setProperty('--dx', (Math.random() * 220 - 110).toFixed(0) + 'px');
        s.style.setProperty('--dy', (Math.random() * 180 - 90).toFixed(0) + 'px');
        s.style.left = (Math.random() * 100).toFixed(1) + '%';
        s.style.top  = (Math.random() * 60 + 10).toFixed(1) + '%';
        card.appendChild(s);
        setTimeout(() => s.remove(), 950);
      }
    }

    // ---------- Reasons I Love You ----------
    const reasons = [
      "the way you make me feel safe without even trying",
      "how your voice calms my heart",
      "the way you love so purely",
      "how you make distance feel smaller",
      "because you are my home",
      "because Allah wrote our names next to each other",
      "because of how great of a mom you are to lannuu",
      "because of your gorgeous messy hair",
      "because of how you put your heart into everything",
      "because of how thoughtful you are",
      "because of how you made me dream of a life with you and lele",
      "because of the way you do asmr and crunch those cheese crisps",
      "because of how pretty you look even when you're not trying",
      "because of how great a singer and dancer you are",
      "because of the way you work so hard",
      "because of the way you stand up for what's right and aren't afraid to say how you feel",
      "because you're mine"
    ];

    const finalReason = "and the biggest reason of allâ€¦ is that i want to choose you, love you, make you the mother to lele and our l4 kids and build a life with you forever ğŸ¤";

    let reasonIndex = 0;
    let finishedReasons = false;

    function nextReason(){
      const box = document.getElementById('reasonsBox');
      if(!box) return;

      if(reasonIndex < reasons.length){
        box.textContent = reasons[reasonIndex];
        reasonIndex++;
        spawnHearts();
        return;
      }

      if(!finishedReasons){
        finishedReasons = true;
        box.innerHTML = `<strong style="color:var(--accent)">${finalReason}</strong>`;
        spawnHearts();
        sparkleBurst();
        return;
      }
    }

    // ---------- Mini tests (sanity checks) ----------
    function assert(cond, msg){ if(!cond) throw new Error('Test failed: ' + msg); }

    window.addEventListener('DOMContentLoaded', () => {
      // soft pulse on the 3 photos when the "after distance" gallery is in view
      const mainGallery = document.getElementById('mainGallery');
      if(mainGallery){
        const photos = Array.from(mainGallery.querySelectorAll('.photo'));
        const io = new IntersectionObserver((entries) => {
          for(const entry of entries){
            for(const p of photos){
              p.classList.toggle('pulse', entry.isIntersecting);
            }
          }
        }, { threshold: 0.35 });
        io.observe(mainGallery);
      }
      // start petals
      setInterval(spawnPetal, 1800);

      // tests: functions exist (will throw loudly if parsing breaks)
      assert(typeof openProposal === 'function', 'openProposal should be defined');
      assert(typeof closeProposal === 'function', 'closeProposal should be defined');
      assert(typeof calcDistance === 'function', 'calcDistance should be defined');
      assert(typeof spawnPetal === 'function', 'spawnPetal should be defined');
      assert(typeof nextReason === 'function', 'nextReason should be defined');

      // tests: reasons array has content
      assert(Array.isArray(reasons) && reasons.length > 0, 'reasons should be a non-empty array');

      // test: haversine returns a reasonable number for Northampton->Madinah
      const km = haversineKm({ lat: 52.2405, lon: -0.9027 }, { lat: 24.5247, lon: 39.5692 });
      assert(km > 3000 && km < 8000, 'distance should be in a plausible range');

      // auto-calc once
      try { calcDistance(); } catch(e) { /* ignore */ }
    });
  </script>
</body>
</html>
